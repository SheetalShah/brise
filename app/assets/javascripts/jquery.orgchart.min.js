/**
 * JQuery Organisation Chart Plugin.
 *
 * Author: Mark Lee
 * Copyright (C)2013 Caprica Software Limited 
 * http://www.capricasoftware.co.uk
 * 
 * Contributions by: Paul Lautman <paul.lautman at gmail.com>
 *
 * This software is licensed under the Creative Commons Attribution-ShareAlike 3.0 License,
 * see here for license terms:
 *
 *     http://creativecommons.org/licenses/by-sa/3.0
 */
(function(a){function n(d,e,k,c){var p=a("<table cellpadding='0' cellspacing='0' border='0'/>"),h=a("<tbody/>"),j=a("<tr/>").addClass("nodes"),g=a("<td/>").addClass("node").attr("colspan",2),b=d.children("ul:first").children("li");1<b.length&&g.attr("colspan",2*b.length);var l=a("<p2>").html(c.nodeText(d));$nodeDiv=a("<div>").addClass("node").addClass("level"+k).data("orgchart-level",k).data("orgchart-node",d).append(l);$nodeDiv.addClass(d.attr("class"));g.append($nodeDiv);j.append(g);h.append(j);
$nodeDiv.click(function(){var f=a(this);c.nodeClicked(f.data("orgchart-node"));c.interactive&&(f=f.closest("tr"),f.next("tr").is(":visible")?c.fade?f.nextAll("tr").fadeOut(c.speed):f.nextAll("tr").hide():c.fade?f.nextAll("tr").fadeIn(c.speed):f.nextAll("tr").show())});if(0<b.length){if(-1==c.depth||k+1<c.depth){d=a("<tr/>").addClass("lines");j=a("<td/>").attr("colspan",2*b.length);d.append(j);g=a("<table cellpadding='0' cellspacing='0' border='0'>");g.append("<tbody>");var l=a("<tr/>").addClass("lines x"),
r=a("<td>").addClass("line left"),s=a("<td>").addClass("line right");l.append(r).append(s);g.children("tbody").append(l);j.append(g);h.append(d);0<b.length&&($nodeDiv.addClass("hasChildren"),c.interactive&&$nodeDiv.hover(function(){a(this).addClass(c.hoverClass)},function(){a(this).removeClass(c.hoverClass)}));var m=a("<tr/>").addClass("lines v");b.each(function(){var c=a("<td/>").addClass("line left top"),b=a("<td/>").addClass("line right top");m.append(c).append(b)});m.find("td:first").removeClass("top");
m.find("td:last").removeClass("top");h.append(m);var q=a("<tr/>");b.each(function(){var b=a("<td/>");b.attr("colspan",2);n(a(this),b,k+1,c);q.append(b)})}else c.stack&&(b=b.clone(),b=a("<ul class='stack'>").append(b),$nodeDiv.after(b));h.append(q)}p.append(h);e.append(p)}a.fn.orgChart=function(d){var e=a.extend({},a.fn.orgChart.defaults,d);return this.each(function(){$this=a(this).clone();-1<e.levels&&$this.find("ul").andSelf().filter(function(){return a(this).parents("ul").length+1>e.levels}).remove();
var d=a("<div class='"+e.chartClass+"'/>");e.interactive&&d.addClass("interactive");$this.is("ul")&&n($this.find("li:first"),d,0,e);d.find("div.node a").click(function(a){a.stopImmediatePropagation()});e.container.append(d)})};a.fn.orgChart.defaults={container:a("body"),depth:-1,levels:-1,stack:!1,chartClass:"orgChart",hoverClass:"hover",nodeText:function(a){return a.clone().children("ul,li").remove().end().html()},interactive:!1,fade:!1,speed:"slow",nodeClicked:function(){}}})(jQuery);
